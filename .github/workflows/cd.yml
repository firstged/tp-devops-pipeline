name: CD Pipeline - Publish Docker Image

# Ce workflow se dÃ©clenche quand on pousse sur la branche 'main'
# (Dans un vrai projet pro, on utiliserait les "releases", mais pour le TP, 'push main' est plus simple Ã  tester)
on:
  push:
    branches:
      - main

jobs:
  build-and-push:
    runs-on: ubuntu-latest

    steps:
      # 1. RÃ©cupÃ©ration du code
      - name: ğŸ›ï¸ Checkout
        uses: actions/checkout@v3

      # 2. Configuration de l'environnement Docker (QEMU + Buildx)
      # C'est nÃ©cessaire pour construire des images proprement
      - name: ğŸ³ Set up QEMU
        uses: docker/setup-qemu-action@v2

      - name: ğŸ³ Set up Docker Buildx
        uses: docker/setup-buildx-action@v2

      # 3. Connexion Ã  Docker Hub (via les secrets qu'on a crÃ©Ã©s)
      - name: ğŸ”‘ Login to Docker Hub
        uses: docker/login-action@v2
        with:
          username: ${{ secrets.DOCKER_USERNAME }}
          password: ${{ secrets.DOCKER_PASSWORD }}

      # 4. Construction et Push de l'image
      - name: ğŸ“¦ Build and push
        uses: docker/build-push-action@v4
        with:
          context: .
          push: true
          # Remplace 'ton-pseudo' par ton VRAI pseudo Docker Hub ci-dessous !
          tags: gedfirst/mon-portfolio:latest
